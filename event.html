<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sports Psycho ‚Ä¢ Event</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --psycho-purple: #5821a6;
      --psycho-deep: #2a0b58;
      --psycho-blue: #4ad2ff;
      --psycho-yellow: #ffdd57;
    }

    body {
      background: var(--psycho-purple);
      background-image: url("https://www.transparenttextures.com/patterns/pw-maze-black.png");
      color: white;
      font-family: 'Inter', sans-serif;
      padding-bottom: 90px;
    }

    .card {
      background: rgba(255, 255, 255, 0.14);
      border: 2px solid rgba(255, 255, 255, 0.18);
      border-radius: 22px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    }
  </style>
</head>

<body>

<!-- HEADER -->
<header class="px-4 py-4 flex items-center justify-between bg-[var(--psycho-deep)] shadow-xl sticky top-0 z-50">
  <a href="club.html" class="text-3xl text-[var(--psycho-yellow)]">‚Üê</a>
  <h1 class="text-xl font-extrabold tracking-wide">Event Details</h1>
  <div class="w-8"></div>
</header>

<!-- EVENT HEADER IMAGE -->
<section class="mt-4 px-4">
  <div class="card overflow-hidden">
    <img src="assets/img/event-images/pickleball-event.jpg" class="w-full h-44 object-cover">
  </div>
</section>

<!-- TOP EVENT DETAILS -->
<section class="px-4 mt-4">
  <h2 class="text-3xl font-extrabold">Pickleball Double Round</h2>
  <p class="opacity-80 text-sm">Hosted by Pickleball Maniacs Club</p>

  <!-- Date / Time -->
  <div class="mt-4 flex items-center space-x-4">
    <span class="text-2xl">üìÖ</span>
    <p class="text-lg font-bold">Tuesday, 6:00 PM</p>
  </div>

  <!-- Location -->
  <div class="mt-3 flex items-center space-x-4">
    <span class="text-2xl">üìç</span>
    <p class="text-lg font-bold">Sports Plex Court 4</p>
  </div>
</section>

<!-- RSVP BUTTONS -->
<section class="px-4 mt-6">
  <div class="flex space-x-4">

    <button id="join-event-btn" class="flex-1 bg-[var(--psycho-blue)] text-black py-3 rounded-xl text-lg font-bold shadow-xl hover:scale-[1.02] transition">
      Join Event
    </button>

    <button id="withdraw-event-btn" class="flex-1 bg-red-400 text-black py-3 rounded-xl text-lg font-bold shadow-xl hover:scale-[1.02] transition">
      Withdraw
    </button>

  </div>

  <!-- Calendar Sync Button -->
  <button id="calendar-sync-btn" class="w-full mt-3 bg-white/20 border border-white/40 text-white py-3 rounded-xl text-lg font-bold shadow-xl hover:scale-[1.02] transition flex items-center justify-center space-x-2">
    <span>üìÖ</span>
    <span>Add to Calendar</span>
  </button>
</section>

<!-- MAP PLACEHOLDER -->
<section class="px-4 mt-8">
  <div class="card p-4 text-center">
    <p class="font-bold text-lg mb-2">Event Location</p>
    <div class="bg-black/40 rounded-xl w-full h-40 flex items-center justify-center">
      <span class="opacity-70">Map Placeholder</span>
    </div>
  </div>
</section>

<!-- PARTICIPANTS -->
<section class="px-4 mt-8">
  <h3 class="text-2xl font-extrabold mb-3">Participants (12)</h3>

  <div class="space-y-4">

    <div class="card p-4 flex items-center space-x-4">
      <img src="assets/img/avatar-default.png" class="w-14 h-14 rounded-full border-2 border-white">
      <div>
        <p class="font-bold text-lg">Alex Johnson</p>
        <p class="text-sm opacity-70">Club Owner</p>
      </div>
    </div>

    <div class="card p-4 flex items-center space-x-4">
      <img src="assets/img/avatar-default.png" class="w-14 h-14 rounded-full border-2 border-white">
      <div>
        <p class="font-bold text-lg">Mia Reyes</p>
        <p class="text-sm opacity-70">Joined 3 days ago</p>
      </div>
    </div>

    <div class="card p-4 flex items-center space-x-4">
      <img src="assets/img/avatar-default.png" class="w-14 h-14 rounded-full border-2 border-white">
      <div>
        <p class="font-bold text-lg">Devon Carter</p>
        <p class="text-sm opacity-70">Confirmed</p>
      </div>
    </div>

  </div>
</section>

<!-- ABOUT -->
<section class="px-4 mt-8 mb-20">
  <h3 class="text-2xl font-extrabold mb-3">About This Event</h3>

  <div class="card p-4 text-sm opacity-90 leading-relaxed">
    <p>
      A fun competitive pickleball double-round event open to all skill levels.  
      Games are played to 11. Partners will rotate each round.  
      Bring your paddle ‚Äî balls will be provided.
    </p>
  </div>
</section>

<!-- FOOTER NAV -->
<nav class="fixed bottom-0 left-0 w-full bg-[var(--psycho-deep)] py-3 shadow-2xl border-t border-white/20">
  <div class="flex justify-around text-xl">
    <a href="dashboard.html" class="opacity-80 hover:opacity-100">üè†</a>
    <a href="club.html" class="text-yellow-300 font-extrabold">‚õ≥</a>
    <a href="calendar.html" class="opacity-80 hover:opacity-100">üìÖ</a>
    <a href="search.html" class="opacity-80 hover:opacity-100">üîç</a>
    <a href="profile.html" class="opacity-80 hover:opacity-100">üë§</a>
  </div>
</nav>

<!-- JavaScript for Event RSVP and Calendar Sync -->
<script>
  /**
   * Sports Psycho - Event Details Module
   * Handles event RSVP and calendar synchronization
   * Developer: Modular design for API integration
   */

  // RSVP functionality
  document.getElementById('join-event-btn').addEventListener('click', async function() {
    const eventId = new URLSearchParams(window.location.search).get('id') || 'demo-event';
    
    try {
      const response = await fetch(`/api/events/${eventId}/rsvp`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('authToken')
        },
        body: JSON.stringify({ status: 'attending' })
      });

      if (response.ok) {
        const result = await response.json();
        if (result.onWaitlist) {
          alert('Event is full. You have been added to the waitlist.');
        } else {
          alert('Successfully joined the event!');
        }
        location.reload();
      } else {
        const error = await response.json();
        alert('Error joining event: ' + (error.message || 'Unknown error'));
      }
    } catch (error) {
      // Demo mode - store locally
      console.log('Joining event:', eventId);
      alert('Successfully joined the event! (Demo mode)');
    }
  });

  document.getElementById('withdraw-event-btn').addEventListener('click', async function() {
    const eventId = new URLSearchParams(window.location.search).get('id') || 'demo-event';
    
    if (!confirm('Are you sure you want to withdraw from this event?')) {
      return;
    }

    try {
      const response = await fetch(`/api/events/${eventId}/rsvp`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('authToken')
        },
        body: JSON.stringify({ status: 'declined' })
      });

      if (response.ok) {
        alert('Successfully withdrawn from the event.');
        location.reload();
      } else {
        const error = await response.json();
        alert('Error withdrawing: ' + (error.message || 'Unknown error'));
      }
    } catch (error) {
      // Demo mode
      console.log('Withdrawing from event:', eventId);
      alert('Successfully withdrawn from the event. (Demo mode)');
    }
  });

  // Calendar sync functionality
  document.getElementById('calendar-sync-btn').addEventListener('click', function() {
    const eventData = {
      name: 'Pickleball Double Round',
      date: '2024-12-24',
      time: '18:00',
      location: 'Sports Plex Court 4',
      description: 'A fun competitive pickleball double-round event'
    };

    // Generate iCalendar file
    const icsContent = generateICS(eventData);
    
    // Create download link
    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'event.ics';
    link.click();
    
    alert('Calendar file downloaded! Import it to your calendar app.');
  });

  /**
   * Generate iCalendar (.ics) file content
   * @param {Object} event - Event data
   * @returns {string} ICS file content
   */
  function generateICS(event) {
    const dtstart = event.date.replace(/-/g, '') + 'T' + event.time.replace(/:/g, '') + '00';
    const dtstamp = new Date().toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    
    return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Sports Psycho//Event//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${Math.random().toString(36).substr(2, 9)}@sportspsycho.com
DTSTAMP:${dtstamp}
DTSTART:${dtstart}
SUMMARY:${event.name}
DESCRIPTION:${event.description}
LOCATION:${event.location}
STATUS:CONFIRMED
SEQUENCE:0
END:VEVENT
END:VCALENDAR`;
  }

  // Load event data from URL parameter or API
  function loadEventData() {
    const eventId = new URLSearchParams(window.location.search).get('id');
    if (eventId) {
      // In production, fetch event details from API
      // fetch(`/api/events/${eventId}`)...
    }
  }

  loadEventData();
</script>

</body>
</html>